<form 
[formGroup]="formGroup" 
(submit)="onFormSubmit()"
[ngClass]="{loading: loading}">
  <fieldset *ngFor="let fieldset of fieldsets" [disabled]="loading">
    <legend>{{ fieldset.legend }}</legend>
    <mat-spinner *ngIf="loading"></mat-spinner>
    <app-success *ngIf="formSuccess" [success]="success"></app-success>
    <div class="fields" *ngIf="!loading && !formSuccess">
        <div class="input-box" *ngFor="let f of fieldset.fields">
            <mat-form-field>
                <input 
                matInput 
                type="{{f.type}}" 
                placeholder="{{ f.placeholder }}" 
                [formControl]="formGroup.controls[f.key]"
                >
                <div class="input-errors" *ngIf="formGroup.controls[f.key].invalid && formGroup.controls[f.key].touched">
                  <p class="input-error" *ngIf="formGroup.controls[f.key].errors.required">
                    {{ f.placeholder }} is required!
                  </p>
                </div>
            </mat-form-field>
        </div>
    </div>
    <div class="fieldset-actions" *ngIf="!loading && !formSuccess">
      <button mat-raised-button type="submit" [disabled]="loading">
          <span *ngIf="!loading">Submit</span>
          <span *ngIf="loading">Submitting...</span>
      </button>
      <button class="cancel" mat-button type="button" (click)="onCancel()">
          Cancel
      </button>
    </div>
  </fieldset>
</form>